{% extends 'base.html' %}

{% block content %}
  <div class="pt-48 flex flex-col justify-center">
    <h1>Status do Processamento</h1>
    <div id="status">
        {{ status }}
    </div>
  </div>


<script>
    function checkTaskStatus(taskId) {
    fetch(`/ajuda_custo/status_task/${taskId}/`)  // Altere a URL conforme necessário
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.text();
        })
        .then(data => {
            document.getElementById('status').innerHTML = data;

            // Verifique se o status não é mais 'PENDING'
            if (!data.includes("Processamento pendente...")) {
                clearInterval(interval);  // Para o polling se não for mais pendente

                // Verifica se o processamento foi concluído ou se houve erro
                if (data.includes("Processamento concluído com sucesso!") || data.includes("Erros encontrados")) {
                    setTimeout(() => {
                        location.reload(); // Recarrega a página após 2 segundos
                    }, 2000);
                }
            }
        })
        .catch(error => console.error('Erro ao buscar o status:', error));
}

const taskId = "{{ task_id }}";  // Supondo que você passe o ID da tarefa para o template
const interval = setInterval(() => checkTaskStatus(taskId), 5000);  // Verifica a cada 5 segundos

</script>

{% endblock %}